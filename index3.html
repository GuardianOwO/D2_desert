<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ¥­èª¬æ˜ç”¨ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸</title>
    <style>
        /*
        ========================================
        CSS (ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©) - ã‚µã‚¤ã‚ºã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¿®æ­£
        ========================================
        */

        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        /* ğŸ–¼ï¸ ãƒ¡ã‚¤ãƒ³ã®ä½œæ¥­ã‚¨ãƒªã‚¢ - ã‚µã‚¤ã‚ºå¤‰æ›´ */
        #work-area {
            position: relative; 
            width: 1188px; /* â¬…ï¸ å¤‰æ›´ */
            height: 846px; /* â¬…ï¸ å¤‰æ›´ */
            margin: 20px auto;
            border: 2px solid #333;
            background-image: url('images/background-base.png'); /* åˆæœŸèƒŒæ™¯ */
            background-size: cover;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden; /* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚¨ãƒªã‚¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ */
        }

        /* ğŸ–±ï¸ ç§»å‹•å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« - ã‚µã‚¤ã‚ºå¤‰æ›´ */
        .draggable-object {
            position: absolute; 
            width: 35px; /* â¬…ï¸ å¤‰æ›´ */
            height: 35px; /* â¬…ï¸ å¤‰æ›´ */
            cursor: grab;
            border: 2px solid rgba(255, 0, 0, 0.5); 
            box-sizing: border-box;
            user-select: none;
            /* ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«æ‰‹å‰ã«è¡¨ç¤º */
            z-index: 10; 
        }
        /* ğŸ“Œ å›ºå®šç”»åƒç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .fixed-draggable-object {
            position: absolute; 
            cursor: grab;
            border: 2px solid rgba(0, 123, 255, 0.192); /* åŒºåˆ¥ã—ã‚„ã™ã„ã‚ˆã†ã«æ ç·šã®è‰²ã‚’å¤‰æ›´ */
            box-sizing: border-box;
            user-select: none;
            z-index: 10;
            /* ã‚µã‚¤ã‚ºã¯JSã§å€‹åˆ¥ã«è¨­å®šã™ã‚‹ãŸã‚ã“ã“ã§ã¯å®šç¾©ã—ãªã„ */
        }

        /* ğŸ”„ 360åº¦å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        @keyframes slow-spin-reverse { /* é€†å›è»¢ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  */
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); } 
        }
        @keyframes slow-spin-forward { /* é †å›è»¢ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  (äºˆå‚™) */
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #rotating-img {
            position: absolute;
            top: 270px; 
            left: 77px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯JSã§è¨­å®šã™ã‚‹ãŸã‚åˆæœŸã¯ãªã— */
            display: none; /* â¬…ï¸ åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            z-index: 5;
        }

        /* ğŸ² ãƒ©ãƒ³ãƒ€ãƒ åˆ‡ã‚Šæ›¿ãˆç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« (å¤‰æ›´ãªã—) */
        .random-image {
            width: 150px;
            height: 100px;
            border: 3px dashed #007bff;
            cursor: pointer;
        }
        #random-area-1 { position: absolute; top: 100px; right: 30px; }
        #random-area-2 { position: absolute; bottom: 30px; left: 30px; }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .instruction-button {
            display: block;
            width: 300px;
            margin: 10px auto;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>ä½œæ¥­èª¬æ˜ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸</h1>

    <div class="control-panel">
        <button id="toggle-background-button" class="instruction-button" style="background-color: #007bff;">
            èƒŒæ™¯ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ (ç¾åœ¨: 1ãƒšãƒ¼ã‚¸ç›®)
        </button>
    </div>

    <div id="work-area">
        <div id="draggable-objects-container"></div>
        
        <img id="rotating-img" 
             src="images/rotating-indicator.png" 
             alt="å›è»¢ã™ã‚‹æ³¨æ„ãƒãƒ¼ã‚¯">

    </div>

    <script>
        /*
        ========================================
        JavaScript (æ©Ÿèƒ½å®Ÿè£…)
        ========================================
        */

        // å…±é€šå¤‰æ•° (CSSã¨åŒæœŸ)
        const workArea = document.getElementById('work-area');
        const container = document.getElementById('draggable-objects-container');
        const ROTATING_IMG = document.getElementById('rotating-img');
        const AREA_WIDTH = 1188;
        const AREA_HEIGHT = 846;
        const OBJECT_SIZE = 30; // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¹…/é«˜ã•

        // çŠ¶æ…‹ç®¡ç†å¤‰æ•° (ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹)
        let currentBackground = 1;
        let statePage1 = null; // 1ãƒšãƒ¼ã‚¸ç›®ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½ç½®
        let statePage2 = null; // 2ãƒšãƒ¼ã‚¸ç›®ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½ç½®
        const toggleButton = document.getElementById('toggle-background-button');
        
        // ğŸš¨ ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ä½¿ç”¨ã™ã‚‹ç”»åƒã‚»ãƒƒãƒˆã‚’ä¿æŒã™ã‚‹ãŸã‚ã®å¤‰æ•° (åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¨­å®š)
        let imageSets = null; 

        // ----------------------------------------------------
        // ğŸš¨ å›ºå®šç”»åƒã®è¨­å®šå€¤ï¼ˆã‚µã‚¤ã‚ºã¨ãƒšãƒ¼ã‚¸ã”ã¨ã®åˆæœŸä½ç½®ï¼‰
        // ----------------------------------------------------
        const FIXED_IMAGE_SETTINGS = {
            'Agraios.png': {
                size: { width: 60, height: 60 }, // ä¾‹ã¨ã—ã¦80x80ã«è¨­å®š
                page1: { top: 250, left: 250 },
                page2: { top: 260, left: 920 }
            },
            'iatros.png': {
                size: { width: 60, height: 60 }, // ä¾‹ã¨ã—ã¦40x60ã«è¨­å®š
                page1: { top: 350, left: 300 },
                page2: { top: 480, left: 520 }
            },
            'epoptes.png': {
                size: { width: 60, height: 60 }, // ä¾‹ã¨ã—ã¦100x40ã«è¨­å®š
                page1: { top: 350, left: 150 },
                page2: { top: 280, left: 90 }
            },
            // â¬…ï¸ ã“ã“ã«beem.pngã®è¨­å®šã‚’è¿½åŠ 
            'beem-1.png': {
                size: { width: 60, height: 160 }, 
                page1: { top: 60, left: 140, rotate: 20, opacity: 1.0 }, // åˆæœŸã¯ä¸é€æ˜ (1.0)
                page2: { top: 0, left: 0, rotate: 90, opacity: 0 } 
            },
            'beem-2.png': {
                size: { width: 60, height: 160 }, 
                page1: { top: 450, left: 90, rotate: 77, opacity: 0.2 }, // åˆæœŸã¯é€é (0.7)
                page2: { top: 0, left: 0, rotate: 90, opacity: 0 }
            },
            'beem-3.png': {
                size: { width: 60, height: 160 }, 
                page1: { top: 320, left: 450, rotate: 140, opacity: 0.2 }, // åˆæœŸã¯é€é (0.7)
                page2: { top: 0, left: 0, rotate: 90, opacity: 0 } 
            }
        };

        // ----------------------------------------------------
        // 1-1. ğŸ–¼ï¸ ç§»å‹•å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”»åƒé¸æŠãƒ­ã‚¸ãƒƒã‚¯
        // ----------------------------------------------------
        function selectDraggableImages() {
            // 1. 1.pngï½10.pngã‹ã‚‰é‡è¤‡ãªã6æšã‚’é¸ã¶
            const allImageNumbers = Array.from({length: 10}, (_, i) => i + 1);
            let randomSelected = [];
            while (randomSelected.length < 6) {
                const randomIndex = Math.floor(Math.random() * allImageNumbers.length);
                const randomNumber = allImageNumbers.splice(randomIndex, 1)[0]; 
                randomSelected.push(`${randomNumber}.png`);
            }

            // 2. å›ºå®šã§è¿½åŠ ã™ã‚‹3ã¤ã®ç”»åƒ
            // const fixedImages = ['Agraios.png', 'iatros.png', 'epoptes.png'];
            const fixedImages = ['Agraios.png', 'iatros.png', 'epoptes.png', 'beem-1.png', 'beem-2.png', 'beem-3.png'];
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³å…¨ä½“ã§ã“ã®ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨
            imageSets = {
                random: randomSelected,
                fixed: fixedImages
            };
            return imageSets;
        }

        // ----------------------------------------------------
        // 1-2. ğŸ–±ï¸ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã¨åˆæœŸé…ç½®
        // ----------------------------------------------------

function initializeDraggableObjects(initialPositions = null) {
            const currentImageSets = imageSets || selectDraggableImages();
            const allFileNames = currentImageSets.random.concat(currentImageSets.fixed);
            const randomImageCount = currentImageSets.random.length; 

            container.innerHTML = ''; 
            const stateMap = new Map(Object.entries(initialPositions || {})); 
            
            // ... (ãƒ©ãƒ³ãƒ€ãƒ ç”»åƒã®åˆæœŸé…ç½®è¨ˆç®—ã¯å¤‰æ›´ãªã—) ...
            const gap = 10;
            const totalWidth = (randomImageCount * OBJECT_SIZE) + ((randomImageCount - 1) * gap);
            // const startX = (AREA_WIDTH / 2) - (totalWidth / 2); 
            const startX = 800
            // const centerY = (AREA_HEIGHT / 2) - (OBJECT_SIZE / 2);
            const centerY = 20

            // ç”»åƒã®ç”Ÿæˆã¨ä½ç½®ã®è¨­å®š
allFileNames.forEach((fileName, index) => {
                const isFixed = index >= randomImageCount; 
                const id = `draggable-obj-${fileName.replace('.', '-')}`;
                const img = document.createElement('img');
                img.id = id;
                img.src = isFixed && fileName.startsWith('beem-') ? 'images/beem.png' : `images/${fileName}`;
                img.alt = `ç§»å‹•å¯èƒ½ãªéƒ¨å“ ${fileName}`;
                
                let top, left, width, height, rotate_style_value, opacity; // ä¿®æ­£ç‚¹: rotate_style_valueã‚’å®šç¾©

                if (!isFixed) {
                    // **A. ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã°ã‚ŒãŸ6æš**
                    img.className = 'draggable-object'; 
                    width = OBJECT_SIZE;
                    height = OBJECT_SIZE;

                    if (stateMap.has(id)) {
                        top = stateMap.get(id).top;
                        left = stateMap.get(id).left;
                    } else {
                        top = `${centerY}px`;
                        left = `${startX + (index * (OBJECT_SIZE + gap))}px`;
                    }
                    rotate_style_value = 'rotate(0deg)';
                    opacity = 1.0;

                } else {
                    // **B. å›ºå®šã®ç”»åƒ**
                    img.className = 'fixed-draggable-object'; 
                    const settings = FIXED_IMAGE_SETTINGS[fileName];
                    
                    width = settings.size.width;
                    height = settings.size.height;

                    if (stateMap.has(id)) {
                        // çŠ¶æ…‹ã‚’å¾©å…ƒ
                        const state = stateMap.get(id);
                        top = state.top;
                        left = state.left;
                        rotate_style_value = state.rotate; // â¬…ï¸ FIX: "45deg" ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾ä½¿ç”¨
                        opacity = state.opacity; 
                    } else {
                        // æ–°è¦ä½œæˆæ™‚ã¯æ‰‹å‹•è¨­å®šå€¤ã‚’ä½¿ç”¨
                        const pageSettings = currentBackground === 1 ? settings.page1 : settings.page2;
                        top = `${pageSettings.top}px`;
                        left = `${pageSettings.left}px`;
                        rotate_style_value = `rotate(${pageSettings.rotate}deg)`; // â¬…ï¸ FIX: æ•°å€¤ã« 'deg' ã‚’ä»˜åŠ ã—ã¦CSSå½¢å¼ã«
                        opacity = pageSettings.opacity;
                    }
                    
                    // å€‹åˆ¥ã‚µã‚¤ã‚ºã‚’é©ç”¨
                    img.style.width = `${width}px`;
                    img.style.height = `${height}px`;

                    // ğŸš¨ beem.pngã®ç”»åƒã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                    if (fileName.startsWith('beem-')) {
                        img.addEventListener('click', handleBeemClick);
                    }
                }

                // ğŸš¨ ä¿®æ­£å¾Œã®ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
                img.style.top = top;
                img.style.left = left;
                img.style.transform = rotate_style_value; // â¬…ï¸ FIX: rotate_style_value ã‚’ç›´æ¥é©ç”¨
                img.style.opacity = opacity;
                
                container.appendChild(img);
            });
            
            attachDragListeners();
        }

        // ----------------------------------------------------
        // 1-3. ğŸ–±ï¸ ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
        // ----------------------------------------------------
        
        let activeDraggable = null;
        let xOffset = 0;
        let yOffset = 0;
        
        function dragStart(e) {
            if (e.target.classList.contains('draggable-object')) {
                activeDraggable = e.target;
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«æœ€å‰é¢ã«æ¥ã‚‹ã‚ˆã†ã«Z-indexã‚’å¤‰æ›´
                activeDraggable.style.zIndex = 100;

                const rect = activeDraggable.getBoundingClientRect();
                xOffset = clientX - rect.left;
                yOffset = clientY - rect.top;
                
                activeDraggable.style.cursor = 'grabbing';
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);
                document.addEventListener('touchmove', drag);
                document.addEventListener('touchend', dragEnd);
            }
        }

        function drag(e) {
            if (!activeDraggable) return;

            e.preventDefault();

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const areaRect = workArea.getBoundingClientRect();
            const objectWidth = activeDraggable.offsetWidth;
            const objectHeight = activeDraggable.offsetHeight;

            let newX = clientX - areaRect.left - xOffset;
            let newY = clientY - areaRect.top - yOffset;
            
            // å¢ƒç•Œãƒã‚§ãƒƒã‚¯ (work-areaå†…ã«åã‚ã‚‹)
            newX = Math.max(0, Math.min(newX, AREA_WIDTH - objectWidth));
            newY = Math.max(0, Math.min(newY, AREA_HEIGHT - objectHeight));

            activeDraggable.style.left = `${newX}px`;
            activeDraggable.style.top = `${newY}px`;
        }

        function dragEnd() {
            if (activeDraggable) {
                activeDraggable.style.cursor = 'grab';
                activeDraggable.style.zIndex = 10; // Z-indexã‚’å…ƒã«æˆ»ã™
            }
            activeDraggable = null;
            
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', dragEnd);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', dragEnd);
        }

        function attachDragListeners() {
            workArea.removeEventListener('mousedown', dragStart); 
            workArea.removeEventListener('touchstart', dragStart);
            workArea.addEventListener('mousedown', dragStart);
            workArea.addEventListener('touchstart', dragStart);
        }
        
        // ----------------------------------------------------
        // 4. ğŸ’¾ èƒŒæ™¯åˆ‡ã‚Šæ›¿ãˆã¨çŠ¶æ…‹ä¸€æ™‚ä¿å­˜
        // ----------------------------------------------------

function saveCurrentState() {
            const state = {};
            const objects = document.querySelectorAll('.draggable-object, .fixed-draggable-object'); 
            objects.forEach(obj => {
                // ã‚¹ã‚¿ã‚¤ãƒ«ã‹ã‚‰ãƒˆãƒƒãƒ—ã¨ãƒ¬ãƒ•ãƒˆã‚’å–å¾—
                const top = obj.style.top;
                const left = obj.style.left;
                
                // transform (å›è»¢)ã¨ opacity (é€éç‡)ã‚’ç¾åœ¨ã®çŠ¶æ…‹ã‹ã‚‰å–å¾—ã—ä¿å­˜
                const transform = obj.style.transform || 'rotate(0deg)';
                const opacity = obj.style.opacity || '1.0';
                const rotateMatch = transform.match(/rotate\(([^)]+)\)/);
                const rotate = rotateMatch ? rotateMatch[1] : '0deg';

                state[obj.id] = {
                    top: top,
                    left: left,
                    rotate: transform, // â¬…ï¸ FIX: transformå…¨ä½“ (ä¾‹: "rotate(45deg)") ã‚’ä¿å­˜ã™ã‚‹
                    opacity: opacity
                };
            });
            
            if (currentBackground === 1) {
                statePage1 = state;
            } else {
                statePage2 = state;
            }
            return state;
        }

        // ----------------------------------------------------
        // 5. âœ¨ beem.pngã®é€éç‡åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ (ãƒšãƒ¼ã‚¸1ã®ã¿æœ‰åŠ¹)
        // ----------------------------------------------------

        function handleBeemClick(e) {
            if (currentBackground !== 1) {
                // ãƒšãƒ¼ã‚¸1ä»¥å¤–ã§ã¯å‹•ä½œã—ãªã„
                return;
            }
            
            const clickedId = e.currentTarget.id; // ä¾‹: draggable-obj-beem-2-png
            const allBeemIds = ['draggable-obj-beem-1-png', 'draggable-obj-beem-2-png', 'draggable-obj-beem-3-png'];

            allBeemIds.forEach(id => {
                const element = document.getElementById(id);
                if (!element) return;
                
                if (id === clickedId) {
                    element.style.opacity = '1.0'; // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‚ã®ã¯ä¸é€æ˜ (0%)
                } else {
                    element.style.opacity = '0.2'; // ãã‚Œä»¥å¤–ã¯é€é (70%)
                }
            });
            
            // çŠ¶æ…‹ã‚’ä¿å­˜ã—ã€åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚é€éç‡ãŒç¶­æŒã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
            saveCurrentState(); 
        }

        function toggleBackground() {
            // 1. ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿å­˜
            saveCurrentState();

            // 2. èƒŒæ™¯ã¨çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
            if (currentBackground === 1) {
                // Page 1 -> Page 2ã¸
                currentBackground = 2;
                workArea.style.backgroundImage = "url('images/background-base2.png')";
                toggleButton.textContent = "èƒŒæ™¯ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ (ç¾åœ¨: 2ãƒšãƒ¼ã‚¸ç›®)";
                
                // ğŸ”„ å›è»¢ç”»åƒã®è¡¨ç¤ºã¨é€†å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
                ROTATING_IMG.style.display = 'block';
                ROTATING_IMG.style.animation = 'slow-spin-reverse 15s linear infinite';
                
                // çŠ¶æ…‹2ãŒæ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚Œã°å¾©å…ƒã€ãªã‘ã‚Œã°æ–°è¦é…ç½®
                if (statePage2) {
                    initializeDraggableObjects(statePage2);
                } else {
                    // Page 2ã®åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚: åˆæœŸé…ç½®ãƒ­ã‚¸ãƒƒã‚¯ã§é…ç½®ã—ã€ãã®çŠ¶æ…‹ã‚’ä¿å­˜
                    initializeDraggableObjects(null); 
                    statePage2 = saveCurrentState(); 
                }

            } else {
                // Page 2 -> Page 1ã¸
                currentBackground = 1;
                workArea.style.backgroundImage = "url('images/background-base.png')";
                toggleButton.textContent = "èƒŒæ™¯ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ (ç¾åœ¨: 1ãƒšãƒ¼ã‚¸ç›®)";
                
                // ğŸ”„ å›è»¢ç”»åƒã®éè¡¨ç¤ºã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åœæ­¢
                ROTATING_IMG.style.display = 'none';
                ROTATING_IMG.style.animation = 'none';

                // çŠ¶æ…‹1ãŒæ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚Œã°å¾©å…ƒã€ãªã‘ã‚Œã°æ–°è¦é…ç½®
                if (statePage1) {
                    initializeDraggableObjects(statePage1);
                } else {
                    // Page 1ã®åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿å®Ÿè¡Œ
                    initializeDraggableObjects(null); 
                    statePage1 = saveCurrentState();
                }
            }
        }

        toggleButton.addEventListener('click', toggleBackground);
        
        // ----------------------------------------------------
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–
        // ----------------------------------------------------
        
        window.onload = function() {
            // ğŸš¨ å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å…±é€šã®ç”»åƒã‚»ãƒƒãƒˆã‚’æ±ºå®š (æœ€åˆã«1å›ã ã‘å®Ÿè¡Œ)
            selectDraggableImages(); 
            
            // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªé…ç½®ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®
            initializeDraggableObjects(null); 
            
            // åˆæœŸé…ç½®ã®çŠ¶æ…‹ã‚’ Page 1 ã®çŠ¶æ…‹ã¨ã—ã¦ä¿å­˜
            statePage1 = saveCurrentState(); 
        };
        
    </script>
</body>
</html>